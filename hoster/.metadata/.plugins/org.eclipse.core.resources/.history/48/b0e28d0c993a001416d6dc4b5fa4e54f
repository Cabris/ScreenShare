package com.myapp.h264streamingviwer;

import com.simpleMessage.sender.MessageSender;

import android.content.Context;
import android.hardware.Sensor;
import android.hardware.SensorEvent;
import android.hardware.SensorEventListener;
import android.hardware.SensorManager;
import android.util.Log;

public class SensorClient extends Thread implements SensorEventListener {
	private SensorManager sManager;
	MessageSender sender;

	@SuppressWarnings("deprecation")
	public SensorClient(Context context, MessageSender sender) {
		this.sender = sender;
		sManager = (SensorManager) context.getSystemService(Context.SENSOR_SERVICE);
		sManager.registerListener(this, sManager.getDefaultSensor(Sensor.TYPE_ORIENTATION),
				SensorManager.SENSOR_DELAY_NORMAL);
		// qTextView = (TextView) ((Activity) context).findViewById(R.id.q_textView);
	}

	Float baseAzimuth;
	Float basePitch;
	Float baseRoll;
	
	/* Rotation values */
	private float xrot;					//X Rotation
	private float yrot;					//Y Rotation
	private float zrot;
	
	@Override
	public void onSensorChanged(SensorEvent event) {
		float azimuth = event.values[0];
		float pitch = event.values[1];
		float roll = event.values[2];
		
		if ( null == baseAzimuth ) {
			baseAzimuth = azimuth;
		}
		if ( null == basePitch ) {
			basePitch = pitch;
		}
		if ( null == baseRoll ) {
			baseRoll = roll;
		}
		
		float azimuthDifference = azimuth - baseAzimuth;
		float pitchDifference = pitch - basePitch;
		float rollDifference = roll - baseRoll;
		
		Log.i("Lesson07", "azimuthDifference = " + azimuthDifference);
		Log.i("Lesson07", "pitchDifference = " + pitchDifference);
		Log.i("Lesson07", "rollDifference = " + rollDifference);
		
		yrot -= rollDifference;
		xrot -= pitchDifference;
		
		baseRoll = roll;
		basePitch = pitch;
	}

	@Override
	public void onAccuracyChanged(Sensor sensor, int accuracy) {
	}

	private void updateQuaternion(float x, float y, float z, float w) {
		 Log.d("SensorClient", "x: "+x+",y: "+y+",z: "+z+",w: "+w);
		String data = x + "," + y + "," + z + "," + w;
		// qTextView.setText("w: " + w + "," + "x: " + x + "," + "y: " + y + "," + "z: " + z);
		sender.getQueue().add(data);
	}

	public void onDestroy() {
		sManager.unregisterListener(this);
	}

}
